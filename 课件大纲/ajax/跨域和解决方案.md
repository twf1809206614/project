# 跨域和解决方案



### 一 同源策略

要知道什么是跨域，得先知道什么是同源策略。

**源（origin）：**包含3个部分，分别是协议，域名（ip），端口。例如：https://192.168.7.194:8080/

**协议：**网络传输的内容的既定规则。例如http协议就是网络传输html文档的规则。还有其他协议，例如ftp。

**域名：**例如www.baidu.com就是一个域名。网页地址上输入域名，最终会被解析成ip。

**端口：**一个应用对应一个端口。以此来区分不同的应用。端口取值范围：0-65535。0-1024的端口被系统占用。

**url：源 + 路径**，构成了一个url。

一个源代表一台服务器，路径代表这台服务器下的某些文件。

例如：https://192.168.7.194:8080/ajax/01.test.html

ajax/01.test.html 就是源 https://192.168.7.194:8080/ 下的一个路径。通过这个路径能够找到一个html文件。



**同源策略：**

为了安全考虑，web标准中严禁不同源的页面之间共享数据。两个共享数据的页面的源必须相同。

前端html文件请求后端服务器文件，前端html的url和后端服务器文件的url的源必须相同才可以请求数据。

协议，域名，端口三者有一样不同，都会违反同源策略而导致请求数据失败。

如果前端html的url地址是：https://192.168.7.194:8080/ajax/01.test.html，

后端文件的url地址是：https://apimusic.linweiqin.com/comment/hot?type=0

这两个url的源不一致，默认是不能请求数据的。

同源策略无处不在。

ajax请求数据必须遵守同源策略，本地存储的数据获取和共享，也必须遵循同源策略。



### 二 跨域

因为同源策略的限制，有些时候我们请求的后台url就是跟当前的html文档的url不同源，例如在本地测试接口时。

为了能够在某些时候请求不同源的后端文件，就需要进行跨域操作。

为了绕过同源策略进行数据请求的行为，就是跨域。



### 三 跨域的解决办法

但凡能够绕过同源策略解决不同源页面间数据请求的行为都可以认为是解决了跨域。

但是常用和流行的解决请求数据的跨域问题的办法，大概有这么几类：

1：代理跨域。（ng反向代理）

2：cors跨域

3：jsonp。（已经过时）

其他解决例如前端文件和前端文件之间的跨域问题，还有很多其他办法，例如domain，postmessage等。

跨域一般是后端解决的问题，前端只做简单配置即可。



**cors跨域**：即是在后端文件中配置一个header。

例如：header("Access-Control-Allow-Origin:*");

其中的 * 表示任何其他源都可以请求该后端文件。后端文件允许跨域，自然可以通过ajax进行请求。

这个 * 还可以改写成指定的某些源。被指定的源可以跨域请求该后端文件数据。



**jsonp跨域**：已经过时。但是面试还有可能被问到。

原理：通过script标签的src属性可以跨域引入文件的原理。书写逻辑非常类似两个函数共享局部变量的逻辑。

过程：

1：前端封装一个函数 fn 用于接收跨域数据。

2：通过script标签的src属性引入后端文件。

3：后端文件调用这个fn函数，并传入跨域数据。



注意，跨域和ajax没有任何的关系，ajax是永远无法跨域的。

axios插件也无法解决跨域问题。





